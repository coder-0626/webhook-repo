<!DOCTYPE html>
<html>
<head>
    <title>GitHub Activity Monitor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .event {
            margin: 15px 0;
            padding: 15px;
            border-radius: 5px;
            background: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .push { border-left: 4px solid #28a745; }
        .pr { border-left: 4px solid #007bff; }
        .merge { border-left: 4px solid #6f42c1; }
        .timestamp {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        h1 {
            color: #24292e;
            border-bottom: 1px solid #e1e4e8;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>GitHub Activity Feed</h1>
    <div id="events-container">
        <!-- Events will be loaded here -->
    </div>

    <script>
        function formatEvent(event) {
            const date = new Date(event.timestamp);
            const options = { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                timeZoneName: 'short'
            };
            const formattedDate = date.toLocaleString('en-US', options);

            let actionText = '';
            switch(event.action) {
                case 'PUSH':
                    actionText = `${event.author} pushed to ${event.to_branch}`;
                    return `<div class="event push">
                                <div>${actionText}</div>
                                <div class="timestamp">${formattedDate}</div>
                            </div>`;
                case 'PULL_REQUEST':
                    actionText = `${event.author} submitted a pull request from ${event.from_branch} to ${event.to_branch}`;
                    return `<div class="event pr">
                                <div>${actionText}</div>
                                <div class="timestamp">${formattedDate}</div>
                            </div>`;
                case 'MERGE':
                    actionText = `${event.author} merged branch ${event.from_branch} to ${event.to_branch}`;
                    return `<div class="event merge">
                                <div>${actionText}</div>
                                <div class="timestamp">${formattedDate}</div>
                            </div>`;
                default:
                    return '';
            }
        }

        function loadEvents() {
    fetch('/api/events')
        .then(response => {
            if (!response.ok) throw new Error('Network error');
            return response.json();
        })
        .then(data => {
            if (!Array.isArray(data)) {
                throw new Error('Invalid data format');
            }
            
            const container = document.getElementById('events-container');
            container.innerHTML = ''; // Clear existing
            
            data.forEach(event => {
                const eventElement = document.createElement('div');
                eventElement.innerHTML = formatEvent(event);
                container.appendChild(eventElement);
            });
        })
        .catch(error => {
            console.error('Failed to load events:', error);
            // Optional: Show error to user
            document.getElementById('events-container').innerHTML = 
                '<div class="error">Failed to load events. Check console.</div>';
        });
}

// Format timestamp properly
function formatDate(timestamp) {
    try {
        const date = new Date(timestamp);
        return date.toLocaleString('en-US', {
            day: 'numeric',
            month: 'long',
            year: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            timeZoneName: 'short'
        });
    } catch (e) {
        console.warn('Invalid timestamp:', timestamp);
        return timestamp; // Fallback to raw value
    }
}

        // Initial load and refresh every 15 seconds
        loadEvents();
        setInterval(loadEvents, 15000);
    </script>
</body>
</html>
